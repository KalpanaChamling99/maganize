<%# ── Hero image ──────────────────────────────────────────── %>
<% if @article.images.attached? %>
  <div class="relative h-[480px] -mx-4 sm:-mx-6 mb-10 overflow-hidden">
    <%= image_tag @article.images.first, alt: @article.title,
      class: "w-full h-full object-cover" %>
    <div class="absolute inset-0 bg-gradient-to-t from-black/70 via-black/20 to-transparent"></div>

    <%# Overlaid meta on image %>
    <div class="absolute bottom-0 left-0 right-0 px-6 sm:px-10 pb-8">
      <div class="max-w-3xl">
        <div class="flex flex-wrap items-center gap-2 mb-4">
          <% if @article.category %>
            <%= link_to @article.category.name, category_path(@article.category),
              class: "text-xs font-bold px-3 py-1 bg-red-500 text-white uppercase tracking-widest hover:bg-red-600 transition-colors" %>
          <% end %>
          <% @article.tags.each do |tag| %>
            <%= link_to "##{tag.name}", tag_path(tag),
              class: "text-xs font-semibold px-2 py-0.5 bg-white/20 text-white uppercase tracking-wide border border-white/30 hover:bg-white/30 transition-colors" %>
          <% end %>
        </div>
        <h1 class="font-heading text-3xl sm:text-4xl lg:text-5xl font-bold text-white leading-tight mb-4">
          <%= @article.title %>
        </h1>
        <div class="flex items-center gap-4 text-sm text-white/70">
          <%= lucide_icon "calendar", class: "w-4 h-4 shrink-0 text-white/60" %>
          <time><%= @article.published_at.strftime("%B %-d, %Y") %></time>
          <% if @article.author %>
            <span class="text-white/40">·</span>
            <%= lucide_icon "user", class: "w-4 h-4 shrink-0 text-white/60" %>
            <%= link_to @article.author.name, team_member_path(@article.author),
              class: "hover:text-white transition-colors" %>
          <% end %>
          <span class="text-white/40">·</span>
          <%= lucide_icon "clock", class: "w-4 h-4 shrink-0 text-white/60" %>
          <span><%= [(@article.body.to_plain_text.split.size / 200.0).ceil, 1].max %> min read</span>
        </div>
      </div>
    </div>
  </div>
<% else %>
  <%# No image: plain header block %>
  <div class="mb-10 pb-8 border-b border-gray-200">
    <div class="flex flex-wrap items-center gap-2 mb-4">
      <% if @article.category %>
        <%= link_to @article.category.name, category_path(@article.category),
          class: "text-xs font-bold px-3 py-1 bg-red-500 text-white uppercase tracking-widest" %>
      <% end %>
      <% @article.tags.each do |tag| %>
        <%= link_to "##{tag.name}", tag_path(tag),
          class: "text-xs font-semibold px-2 py-0.5 border border-gray-300 text-gray-500 uppercase tracking-wide hover:bg-gray-900 hover:text-white hover:border-gray-900 transition-colors" %>
      <% end %>
    </div>
    <h1 class="font-heading text-3xl sm:text-4xl lg:text-5xl font-bold leading-tight mb-4">
      <%= @article.title %>
    </h1>
    <div class="flex items-center gap-4 text-sm text-gray-400">
      <%= lucide_icon "calendar", class: "w-4 h-4 shrink-0" %>
      <time><%= @article.published_at.strftime("%B %-d, %Y") %></time>
      <% if @article.author %>
        <span>·</span>
        <%= lucide_icon "user", class: "w-4 h-4 shrink-0" %>
        <%= link_to @article.author.name, team_member_path(@article.author),
          class: "hover:text-gray-700 transition-colors" %>
      <% end %>
      <span>·</span>
      <%= lucide_icon "clock", class: "w-4 h-4 shrink-0" %>
      <span><%= [(@article.body.to_plain_text.split.size / 200.0).ceil, 1].max %> min read</span>
    </div>
  </div>
<% end %>

<%# ── Article body ─────────────────────────────────────────── %>
<div class="max-w-3xl mx-auto">

  <%# Excerpt / standfirst %>
  <% if @article.excerpt.present? %>
    <p class="text-xl text-gray-600 leading-relaxed mb-8 pb-8 border-b border-gray-200">
      <%= @article.excerpt %>
    </p>
  <% end %>

  <%# Body content %>
  <div class="prose prose-lg prose-gray max-w-none
    prose-headings:font-heading prose-headings:font-bold
    prose-h2:text-2xl prose-h2:mt-10 prose-h2:mb-4
    prose-h3:text-xl prose-h3:mt-8 prose-h3:mb-3
    prose-p:leading-relaxed prose-p:text-gray-700 prose-p:mb-5
    prose-a:text-red-600 prose-a:no-underline hover:prose-a:underline
    prose-blockquote:border-l-4 prose-blockquote:border-red-500
    prose-blockquote:pl-4 prose-blockquote:italic prose-blockquote:text-gray-500
    prose-img:rounded prose-img:shadow-md">
    <%= @article.body %>
  </div>

  <%# ── Gallery images (skip first — used as cover) ────────── %>
  <% if @article.images.count > 1 %>
    <div class="mt-10 pt-8 border-t border-gray-200">
      <p class="text-xs font-semibold tracking-widest uppercase text-gray-400 mb-4">Gallery</p>
      <div class="grid grid-cols-2 sm:grid-cols-3 gap-3">
        <% @article.images[1..].each do |image| %>
          <%= image_tag image, alt: @article.title,
            class: "w-full h-48 object-cover border border-gray-100 hover:opacity-90 transition-opacity" %>
        <% end %>
      </div>
    </div>
  <% end %>

  <%# ── Tags ──────────────────────────────────────────────── %>
  <% if @article.tags.any? %>
    <div class="mt-10 pt-8 border-t border-gray-200">
      <p class="text-xs font-semibold tracking-widest uppercase text-gray-400 mb-3">Tags</p>
      <div class="flex flex-wrap gap-2">
        <% @article.tags.each do |tag| %>
          <%= link_to "##{tag.name}", tag_path(tag),
            class: "text-sm px-3 py-1.5 border border-gray-200 hover:border-gray-900 hover:bg-gray-900 hover:text-white transition-all" %>
        <% end %>
      </div>
    </div>
  <% end %>

  <%# ── Author card ─────────────────────────────────────────── %>
  <% if @article.author %>
    <% author = @article.author %>
    <div class="mt-10 pt-8 border-t border-gray-200">
      <p class="text-xs font-semibold tracking-widest uppercase text-gray-400 mb-4">Written by</p>
      <div class="flex items-start gap-4">
        <%= link_to team_member_path(author) do %>
          <div class="w-14 h-14 rounded-full overflow-hidden bg-gray-100 flex items-center justify-center text-gray-500 font-heading font-bold text-lg shrink-0 ring-2 ring-gray-200">
            <% if author.avatar.attached? %>
              <%= image_tag author.avatar, class: "w-full h-full object-cover" %>
            <% else %>
              <%= author.name.split.map(&:first).first(2).join %>
            <% end %>
          </div>
        <% end %>
        <div>
          <%= link_to author.name, team_member_path(author),
            class: "font-heading text-lg font-bold text-gray-900 hover:text-red-600 transition-colors" %>
          <% if author.role.present? %>
            <p class="text-xs uppercase tracking-widest text-gray-400 mt-0.5"><%= author.role %></p>
          <% end %>
          <% if author.bio.present? %>
            <p class="text-sm text-gray-500 leading-relaxed mt-2"><%= author.bio %></p>
          <% end %>
        </div>
      </div>
    </div>
  <% end %>

  <%# ── Back nav ────────────────────────────────────────────── %>
  <div class="mt-10 pt-6 border-t border-gray-200 flex items-center justify-between text-sm text-gray-400">
    <%= link_to "← Back to articles", articles_path, class: "hover:text-gray-900 transition-colors" %>
    <% if @article.category %>
      <%= link_to "More in #{@article.category.name} →", category_path(@article.category),
        class: "hover:text-gray-900 transition-colors" %>
    <% end %>
  </div>
</div>

<%# ── Related articles ─────────────────────────────────────── %>
<% if @related_articles.any? %>
  <div class="mt-16 pt-10 border-t border-gray-200">
    <div class="flex items-center gap-3 mb-8">
      <span class="text-xs font-semibold tracking-widest uppercase text-gray-400">Related Articles</span>
      <div class="flex-1 h-px bg-gray-200"></div>
    </div>

    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
      <% @related_articles.each do |article| %>
        <%= render "articles/article_card", article: article,
          image_height: "h-48",
          tag_limit: 0,
          title_size: "text-base",
          card_padding: "p-4",
          date_color: "text-gray-400",
          placeholder_icon_size: "w-8 h-8",
          show_excerpt: false %>
      <% end %>
    </div>
  </div>
<% end %>
