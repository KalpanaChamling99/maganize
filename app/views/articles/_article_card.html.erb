<%#
  Locals:
    article              (required)
    image_height         default: "h-[350px]"
    show_category_badge  default: true
    tag_limit            default: 3  (0 = no tags shown)
    title_size           default: "text-xl"
    card_padding         default: "p-5"
    date_color           default: "text-gray-500"
    badge_padding        default: "px-4 py-2.5"
    placeholder_icon_size default: "w-10 h-10"
    show_excerpt         default: true
    bookmark_mode        default: false (shows filled remove button instead of toggle)
%>
<%
  tag_colors            = %w[bg-purple-600 bg-blue-500 bg-green-600 bg-yellow-500 bg-pink-600]
  image_height          ||= "h-[350px]"
  show_category_badge   = local_assigns.fetch(:show_category_badge, true)
  tag_limit             ||= 3
  title_size            ||= "text-xl"
  card_padding          ||= "p-5"
  date_color            ||= "text-gray-500"
  badge_padding         ||= "px-4 py-2.5"
  placeholder_icon_size ||= "w-10 h-10"
  show_excerpt          = local_assigns.fetch(:show_excerpt, true)
  bookmark_mode         = local_assigns.fetch(:bookmark_mode, false)
%>
<article class="article-card group bg-white overflow-hidden transition-shadow hover:shadow-xl">
  <div class="relative <%= image_height %> overflow-hidden">
    <% if article.images.attached? %>
      <%= image_tag article.images.first, alt: article.title,
        class: "w-full h-full object-cover group-hover:scale-105 transition-transform duration-500" %>
    <% else %>
      <div class="placeholder-bg w-full h-full bg-gray-100 flex items-center justify-center">
        <%= lucide_icon "image", class: "#{placeholder_icon_size} text-gray-300" %>
      </div>
    <% end %>

    <%# Dark gradient overlay %>
    <div class="absolute inset-0 bg-gradient-to-t from-black/60 via-black/10 to-transparent pointer-events-none group-hover:opacity-0 transition-opacity duration-300"></div>

    <%# Top-left: tags %>
    <div class="absolute top-3 left-3 flex flex-wrap gap-1">
      <% article.tags.first(tag_limit).each do |tag| %>
        <%= link_to tag_path(tag),
              class: "text-xs font-semibold px-2 py-0.5 bg-black/50 text-white border border-white/30 hover:bg-black/70 transition-colors backdrop-blur-sm" do %>
          #<%= tag.name %>
        <% end %>
      <% end %>
    </div>

    <%# Bottom-left: read time â€” always visible %>
    <div class="absolute bottom-3 left-3">
      <span class="bg-black/70 backdrop-blur-sm text-white text-xs font-semibold px-2.5 py-1 rounded-full inline-flex items-center gap-1.5">
        <%= lucide_icon "clock", class: "w-3 h-3" %>
        <%= [(article.body.to_plain_text.split.size / 200.0).ceil, 1].max %> min read
      </span>
    </div>

    <%# Bottom-right: bookmark button %>
    <% unless bookmark_mode %>
      <div class="absolute bottom-3 right-3">
        <button type="button"
                data-controller="bookmark"
                data-bookmark-article-id-value="<%= article.id %>"
                data-action="click->bookmark#toggle"
                class="bookmark-btn w-8 h-8 rounded-full bg-black/50 backdrop-blur-sm flex items-center justify-center hover:bg-black/70 transition-colors"
                aria-label="Bookmark this article">
          <svg class="bookmark-icon-empty w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-3.5L5 21V5z"/>
          </svg>
          <svg class="bookmark-icon-filled w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
            <path d="M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-3.5L5 21V5z"/>
          </svg>
        </button>
      </div>
    <% end %>


  </div>

  <div class="<%= card_padding %>">
    <div class="article-meta flex items-center gap-4 text-xs <%= date_color %> mb-3">
      <% if article.author %>
        <%= link_to team_member_path(article.author), class: "flex items-center gap-1.5 hover:opacity-80 transition-opacity min-w-0" do %>
          <div class="author-avatar w-10 h-10 rounded-full overflow-hidden bg-gray-200 shrink-0 flex items-center justify-center border-2 border-gray-300">
            <% if article.author.avatar.attached? %>
              <%= image_tag article.author.avatar, class: "w-full h-full object-cover" %>
            <% else %>
              <span class="text-[10px] font-bold text-gray-500 leading-none"><%= article.author.name.split.map(&:first).first(2).join.upcase %></span>
            <% end %>
          </div>
          <span class="truncate"><%= article.author.name %></span>
        <% end %>
      <% end %>
      <div class="flex items-center gap-2">
        <%= lucide_icon "calendar", class: "w-3.5 h-3.5 shrink-0" %>
        <%= link_to articles_path(year: article.published_at.year, month: article.published_at.month),
              class: "hover:text-red-500 transition-colors" do %>
          <time><%= article.published_at.strftime("%B %-d, %Y") %></time>
        <% end %>
      </div>
    </div>
    <% if article.categories.any? %>
      <div class="flex flex-wrap gap-1 mb-2">
        <% article.categories.each do |cat| %>
          <%= link_to cat.name, category_path(cat),
                class: "text-[11px] font-bold px-2 py-0.5 text-white uppercase tracking-wide hover:opacity-90 transition-opacity",
                style: category_badge_style(cat) %>
        <% end %>
      </div>
    <% end %>
    <h3 class="<%= title_size %> font-bold leading-snug mb-2">
      <%= link_to article.title, article_path(article),
        class: "font-heading text-red-600 hover:text-red-700 transition-colors" %>
    </h3>
    <% if show_excerpt %>
      <p class="article-excerpt text-gray-500 text-sm leading-relaxed line-clamp-3 mb-4"><%= article.excerpt %></p>
    <% end %>
    <div class="card-footer pt-3 border-t border-gray-100 flex items-center justify-start gap-3">
      <div class="flex items-center gap-2">
        <%= link_to "Read More", article_path(article),
          class: "text-sm font-semibold px-4 py-2 bg-red-500 text-white hover:bg-red-600 transition-colors" %>
        <% if bookmark_mode %>
          <button type="button"
                  data-id="<%= article.id %>"
                  class="bookmark-remove-btn bookmark-btn bookmark-btn--show"
                  aria-label="Remove bookmark">
            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
              <path d="M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-3.5L5 21V5z"/>
            </svg>
          </button>
        <% end %>
      </div>
    </div>
  </div>
</article>
