<aside class="w-60 bg-gray-900 text-white flex flex-col fixed inset-y-0 left-0 z-30">

  <%# Branding %>
  <div class="px-6 py-5 border-b border-gray-800">
    <span class="font-serif text-xl font-bold tracking-tight">The Magazine</span>
    <p class="text-xs text-gray-500 mt-0.5 tracking-widest uppercase">Admin Panel</p>
  </div>

  <%# Navigation %>
  <nav class="flex-1 px-3 py-5 space-y-0.5 overflow-y-auto">

    <%# Dashboard %>
    <%= link_to admin_root_path,
      class: "flex items-center gap-3 px-3 py-2.5 rounded text-sm font-medium transition-colors #{current_page?(admin_root_path) ? 'bg-white/10 text-white' : 'text-gray-400 hover:bg-white/5 hover:text-white'}" do %>
      <%= lucide_icon "gauge", class: "h-4 w-4 shrink-0" %>
      Dashboard
    <% end %>

    <%# ── Content dropdown ──────────────────────────────────── %>
    <% content_active = %w[/admin/articles /admin/categories /admin/tags /admin/media /admin/team_members /admin/collections].any? { |p| request.path.start_with?(p) } %>
    <div data-controller="dropdown" data-dropdown-open-value="<%= content_active %>">
      <button data-action="click->dropdown#toggle"
              class="w-full flex items-center gap-3 px-3 py-2.5 rounded text-sm font-medium transition-colors <%= content_active ? 'bg-white/10 text-white' : 'text-gray-400 hover:bg-white/5 hover:text-white' %>">
        <%= lucide_icon "newspaper", class: "h-4 w-4 shrink-0" %>
        <span class="flex-1 text-left">Content</span>
        <svg data-dropdown-target="chevron" class="h-3.5 w-3.5 shrink-0 transition-transform duration-200" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
          <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"/>
        </svg>
      </button>
      <div data-dropdown-target="menu" class="pl-3 space-y-0.5">
        <%= link_to admin_articles_path,
          class: "flex items-center gap-3 px-3 py-2 rounded text-sm font-medium transition-colors #{request.path.start_with?('/admin/articles') ? 'bg-white/10 text-white' : 'text-gray-400 hover:bg-white/5 hover:text-white'}" do %>
          <%= lucide_icon "file-text", class: "h-4 w-4 shrink-0" %>
          Articles
          <span class="ml-auto text-xs bg-white/10 px-2 py-0.5 rounded-full"><%= Article.count %></span>
        <% end %>
        <%= link_to admin_categories_path,
          class: "flex items-center gap-3 px-3 py-2 rounded text-sm font-medium transition-colors #{request.path.start_with?('/admin/categories') ? 'bg-white/10 text-white' : 'text-gray-400 hover:bg-white/5 hover:text-white'}" do %>
          <%= lucide_icon "layers", class: "h-4 w-4 shrink-0" %>
          Categories
          <span class="ml-auto text-xs bg-white/10 px-2 py-0.5 rounded-full"><%= Category.count %></span>
        <% end %>
        <%= link_to admin_tags_path,
          class: "flex items-center gap-3 px-3 py-2 rounded text-sm font-medium transition-colors #{request.path.start_with?('/admin/tags') ? 'bg-white/10 text-white' : 'text-gray-400 hover:bg-white/5 hover:text-white'}" do %>
          <%= lucide_icon "tag", class: "h-4 w-4 shrink-0" %>
          Tags
          <span class="ml-auto text-xs bg-white/10 px-2 py-0.5 rounded-full"><%= Tag.count %></span>
        <% end %>
        <%= link_to admin_media_path,
          class: "flex items-center gap-3 px-3 py-2 rounded text-sm font-medium transition-colors #{request.path.start_with?('/admin/media') ? 'bg-white/10 text-white' : 'text-gray-400 hover:bg-white/5 hover:text-white'}" do %>
          <%= lucide_icon "image", class: "h-4 w-4 shrink-0" %>
          Media
          <span class="ml-auto text-xs bg-white/10 px-2 py-0.5 rounded-full"><%= ActiveStorage::Attachment.where(record_type: "Article", name: "images").count %></span>
        <% end %>
        <%= link_to admin_team_members_path,
          class: "flex items-center gap-3 px-3 py-2 rounded text-sm font-medium transition-colors #{request.path.start_with?('/admin/team_members') ? 'bg-white/10 text-white' : 'text-gray-400 hover:bg-white/5 hover:text-white'}" do %>
          <%= lucide_icon "users", class: "h-4 w-4 shrink-0" %>
          Team Members
          <span class="ml-auto text-xs bg-white/10 px-2 py-0.5 rounded-full"><%= TeamMember.count %></span>
        <% end %>
        <%= link_to admin_collections_path,
          class: "flex items-center gap-3 px-3 py-2 rounded text-sm font-medium transition-colors #{request.path.start_with?('/admin/collections') ? 'bg-white/10 text-white' : 'text-gray-400 hover:bg-white/5 hover:text-white'}" do %>
          <%= lucide_icon "bookmark", class: "h-4 w-4 shrink-0" %>
          Collections
          <span class="ml-auto text-xs bg-white/10 px-2 py-0.5 rounded-full"><%= Collection.count %></span>
        <% end %>
      </div>
    </div>

    <%# ── Site dropdown ─────────────────────────────────────── %>
    <% site_active = request.path.start_with?('/admin/settings') %>
    <div data-controller="dropdown" data-dropdown-open-value="<%= site_active %>">
      <button data-action="click->dropdown#toggle"
              class="w-full flex items-center gap-3 px-3 py-2.5 rounded text-sm font-medium transition-colors <%= site_active ? 'bg-white/10 text-white' : 'text-gray-400 hover:bg-white/5 hover:text-white' %>">
        <%= lucide_icon "globe", class: "h-4 w-4 shrink-0" %>
        <span class="flex-1 text-left">Site</span>
        <svg data-dropdown-target="chevron" class="h-3.5 w-3.5 shrink-0 transition-transform duration-200" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
          <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"/>
        </svg>
      </button>
      <div data-dropdown-target="menu" class="pl-3 space-y-0.5">
        <%= link_to admin_settings_path,
          class: "flex items-center gap-3 px-3 py-2 rounded text-sm font-medium transition-colors #{request.path.start_with?('/admin/settings') ? 'bg-white/10 text-white' : 'text-gray-400 hover:bg-white/5 hover:text-white'}" do %>
          <%= lucide_icon "settings", class: "h-4 w-4 shrink-0" %>
          Settings
        <% end %>
      </div>
    </div>

    <%# ── Access dropdown — conditionally shown ─────────────── %>
    <% if current_admin_user&.can?("manage_users") || current_admin_user&.can?("manage_roles") %>
      <% access_active = request.path.start_with?('/admin/users', '/admin/roles') %>
      <div data-controller="dropdown" data-dropdown-open-value="<%= access_active %>">
        <button data-action="click->dropdown#toggle"
                class="w-full flex items-center gap-3 px-3 py-2.5 rounded text-sm font-medium transition-colors <%= access_active ? 'bg-white/10 text-white' : 'text-gray-400 hover:bg-white/5 hover:text-white' %>">
          <%= lucide_icon "lock", class: "h-4 w-4 shrink-0" %>
          <span class="flex-1 text-left">Access</span>
          <svg data-dropdown-target="chevron" class="h-3.5 w-3.5 shrink-0 transition-transform duration-200" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
            <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"/>
          </svg>
        </button>
        <div data-dropdown-target="menu" class="pl-3 space-y-0.5">
          <% if current_admin_user.can?("manage_users") %>
            <%= link_to admin_users_path,
              class: "flex items-center gap-3 px-3 py-2 rounded text-sm font-medium transition-colors #{request.path.start_with?('/admin/users') ? 'bg-white/10 text-white' : 'text-gray-400 hover:bg-white/5 hover:text-white'}" do %>
              <%= lucide_icon "shield", class: "h-4 w-4 shrink-0" %>
              Users
              <span class="ml-auto text-xs bg-white/10 px-2 py-0.5 rounded-full"><%= AdminUser.count %></span>
            <% end %>
          <% end %>
          <% if current_admin_user.can?("manage_roles") %>
            <%= link_to admin_roles_path,
              class: "flex items-center gap-3 px-3 py-2 rounded text-sm font-medium transition-colors #{request.path.start_with?('/admin/roles') ? 'bg-white/10 text-white' : 'text-gray-400 hover:bg-white/5 hover:text-white'}" do %>
              <%= lucide_icon "key", class: "h-4 w-4 shrink-0" %>
              Roles
              <span class="ml-auto text-xs bg-white/10 px-2 py-0.5 rounded-full"><%= Role.count %></span>
            <% end %>
          <% end %>
        </div>
      </div>
    <% end %>

    <%# ── Quick Add dropdown — permission-gated ─────────────── %>
    <% if current_admin_user&.can?("create_articles") || current_admin_user&.can?("manage_categories") || current_admin_user&.can?("manage_tags") %>
      <div data-controller="dropdown" data-dropdown-open-value="false">
        <button data-action="click->dropdown#toggle"
                class="w-full flex items-center gap-3 px-3 py-2.5 rounded text-sm font-medium transition-colors text-gray-400 hover:bg-white/5 hover:text-white">
          <%= lucide_icon "plus-circle", class: "h-4 w-4 shrink-0" %>
          <span class="flex-1 text-left">Quick Add</span>
          <svg data-dropdown-target="chevron" class="h-3.5 w-3.5 shrink-0 transition-transform duration-200" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
            <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"/>
          </svg>
        </button>
        <div data-dropdown-target="menu" class="pl-3 space-y-0.5">
          <% if current_admin_user.can?("create_articles") %>
            <%= link_to new_admin_article_path,
              class: "flex items-center gap-3 px-3 py-2 rounded text-sm font-medium text-gray-400 hover:bg-white/5 hover:text-white transition-colors" do %>
              <%= lucide_icon "plus", class: "h-4 w-4 shrink-0" %>
              New Article
            <% end %>
          <% end %>
          <% if current_admin_user.can?("manage_categories") %>
            <%= link_to new_admin_category_path,
              class: "flex items-center gap-3 px-3 py-2 rounded text-sm font-medium text-gray-400 hover:bg-white/5 hover:text-white transition-colors" do %>
              <%= lucide_icon "plus", class: "h-4 w-4 shrink-0" %>
              New Category
            <% end %>
          <% end %>
          <% if current_admin_user.can?("manage_tags") %>
            <%= link_to new_admin_tag_path,
              class: "flex items-center gap-3 px-3 py-2 rounded text-sm font-medium text-gray-400 hover:bg-white/5 hover:text-white transition-colors" do %>
              <%= lucide_icon "plus", class: "h-4 w-4 shrink-0" %>
              New Tag
            <% end %>
          <% end %>
        </div>
      </div>
    <% end %>

  </nav>

  <%# Footer — user info + logout %>
  <div class="px-4 py-4 border-t border-gray-800 space-y-1">
    <% if current_admin_user %>
      <%= link_to admin_profile_path,
        class: "flex items-center gap-2.5 px-1 py-1.5 rounded hover:bg-white/5 transition-colors group" do %>
        <div class="w-7 h-7 rounded-full overflow-hidden bg-red-600 flex items-center justify-center shrink-0 ring-1 ring-white/10">
          <% if current_admin_user.avatar.attached? %>
            <%= image_tag current_admin_user.avatar, class: "w-full h-full object-cover" %>
          <% else %>
            <span class="text-[10px] font-bold text-white leading-none">
              <%= current_admin_user.name.split.map(&:first).first(2).join.upcase %>
            </span>
          <% end %>
        </div>
        <div class="min-w-0 flex-1">
          <p class="text-xs text-gray-300 truncate leading-tight group-hover:text-white transition-colors"><%= current_admin_user.name %></p>
          <p class="text-[10px] text-gray-500 uppercase tracking-widest leading-tight"><%= current_admin_user.role&.name || "No role" %></p>
        </div>
        <%= lucide_icon "settings", class: "h-3.5 w-3.5 text-gray-600 group-hover:text-gray-400 shrink-0 transition-colors" %>
      <% end %>
      <%= link_to admin_logout_path, data: { turbo_method: :delete },
        class: "flex items-center gap-2 px-3 py-1.5 text-xs text-gray-500 hover:text-white hover:bg-white/5 rounded transition-colors w-full" do %>
        <%= lucide_icon "log-out", class: "h-3.5 w-3.5 shrink-0" %>
        Sign out
      <% end %>
    <% end %>
    <%= link_to root_path,
      class: "flex items-center gap-2 px-3 py-1.5 text-xs text-gray-500 hover:text-white hover:bg-white/5 rounded transition-colors",
      target: "_blank" do %>
      <%= lucide_icon "external-link", class: "h-3.5 w-3.5" %>
      View site
    <% end %>
  </div>

</aside>
