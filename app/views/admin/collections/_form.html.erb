<%= form_with(model: [:admin, collection], class: "space-y-8") do |form| %>

  <% if collection.errors.any? %>
    <div class="bg-red-50 border border-red-200 px-5 py-4">
      <p class="text-sm font-semibold text-red-700 mb-2">
        <%= pluralize(collection.errors.count, "error") %> prevented this collection from being saved:
      </p>
      <ul class="list-disc list-inside text-sm text-red-600 space-y-1">
        <% collection.errors.each do |error| %>
          <li><%= error.full_message %></li>
        <% end %>
      </ul>
    </div>
  <% end %> 

  <%# Title %>
  <div>
    <%= form.label :title, "Collection Title", class: "block text-xs font-semibold tracking-widest uppercase text-gray-500 mb-2" %>
    <%= form.text_field :title,
      placeholder: "e.g. Editor's Picks, Weekend Reads…",
      class: "w-full text-xl font-bold border-0 border-b-2 border-gray-200 focus:border-gray-900 focus:outline-none focus:ring-0 py-2 px-0 placeholder-gray-300 bg-transparent transition-colors" %>
  </div>

  <%# Cover Image %>
  <div>
    <%= form.label :cover_image, "Cover Image", class: "block text-xs font-semibold tracking-widest uppercase text-gray-500 mb-3" %>
    <% if collection.cover_image.attached? %>
      <div class="mb-3 relative">
        <%= image_tag collection.cover_image, class: "h-40 w-full object-cover border border-gray-200" %>
        <%= button_to purge_cover_admin_collection_path(collection), method: :delete,
          data: { turbo_confirm: "Remove the cover image?" },
          class: "absolute top-2 right-2 w-6 h-6 bg-white border border-gray-200 text-gray-500 hover:text-red-600 hover:border-red-300 flex items-center justify-center transition-colors cursor-pointer",
          form: { style: "display:inline" },
          title: "Remove cover image" do %>
          &times;
        <% end %>
      </div>
    <% end %>
    <%= form.file_field :cover_image, accept: "image/*",
      class: "block w-full text-sm text-gray-500 file:mr-3 file:py-1.5 file:px-4 file:border file:border-gray-200 file:text-xs file:font-semibold file:tracking-widest file:uppercase file:bg-white file:text-gray-700 hover:file:bg-gray-50 file:cursor-pointer" %>
    <p class="text-xs text-gray-400 mt-1.5">Displayed as the collection header. JPG or PNG recommended.</p>
  </div>

  <%# Articles dropdown (Tom Select) %>
  <div>
    <label class="block text-xs font-semibold tracking-widest uppercase text-gray-500 mb-2">Articles</label>
    <select name="collection[article_ids][]"
            id="collection_article_ids"
            multiple
            data-controller="tom-select"
            class="w-full">
      <% @articles.each do |article| %>
        <option value="<%= article.id %>"
                <%= "selected" if collection.article_ids.include?(article.id) %>>
          <%= article.title %><%= article.category ? " — #{article.category.name}" : "" %>
        </option>
      <% end %>
    </select>
  </div>

  <%# Feature on homepage %>
  <div class="flex items-center gap-3 py-4 border-t border-gray-100">
    <%= form.check_box :featured, class: "w-4 h-4 rounded border-gray-300 text-gray-900 focus:ring-gray-900 cursor-pointer" %>
    <div>
      <%= form.label :featured, "Feature on homepage", class: "text-sm font-semibold text-gray-800 cursor-pointer" %>
      <p class="text-xs text-gray-400 mt-0.5">Featured collections appear as sections on the homepage.</p>
    </div>
  </div>

  <%# Actions %>
  <div class="flex items-center gap-4 pt-4 border-t border-gray-100">
    <%= form.submit collection.new_record? ? "Create Collection" : "Save Changes",
      class: "bg-gray-900 text-white text-xs font-semibold tracking-widest uppercase px-6 py-2.5 hover:bg-gray-700 transition-colors cursor-pointer" %>
    <%= link_to "Cancel", admin_collections_path,
      class: "text-xs font-semibold text-gray-400 hover:text-gray-700 transition-colors" %>
  </div>

<% end %>
