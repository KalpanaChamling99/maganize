<%= form_with(model: role,
  url: role.new_record? ? admin_roles_path : admin_role_path(role),
  class: "space-y-8") do |form| %>

  <% if role.errors.any? %>
    <div class="bg-red-50 border border-red-200 px-5 py-4">
      <p class="text-sm font-semibold text-red-700 mb-2">
        <%= pluralize(role.errors.count, "error") %> prevented this role from being saved:
      </p>
      <ul class="list-disc list-inside text-sm text-red-600 space-y-1">
        <% role.errors.each do |error| %>
          <li><%= error.full_message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <%# Name %>
  <div>
    <%= form.label :name, "Role Name", class: "block text-xs font-semibold tracking-widest uppercase text-gray-500 mb-2" %>
    <%= form.text_field :name,
      placeholder: "e.g. Editor, Publisher",
      class: "w-full border border-gray-200 px-3 py-2.5 text-sm focus:border-gray-900 focus:outline-none focus:ring-0 transition-colors" %>
  </div>

  <%# Permissions %>
  <div>
    <p class="text-xs font-semibold tracking-widest uppercase text-gray-500 mb-4">Permissions</p>
    <div class="space-y-6">
      <% Role::PERMISSION_GROUPS.each do |group_name, keys| %>
        <div>
          <p class="text-xs font-semibold text-gray-700 mb-2 uppercase tracking-widest"><%= group_name %></p>
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-2">
            <% keys.each do |key| %>
              <label class="flex items-center gap-3 px-3 py-2.5 border border-gray-100 hover:border-gray-300 cursor-pointer transition-colors group">
                <input type="checkbox"
                  name="role[permissions][]"
                  value="<%= key %>"
                  <%= role.permissions.include?(key) ? "checked" : "" %>
                  class="w-4 h-4 rounded border-gray-300 text-gray-900 focus:ring-gray-900 focus:ring-offset-0">
                <span class="text-sm text-gray-700 group-hover:text-gray-900">
                  <%= Role::PERMISSION_LABELS[key] %>
                </span>
              </label>
            <% end %>
          </div>
        </div>
      <% end %>
    </div>
    <%# Hidden field ensures an empty array is submitted when no checkboxes are checked %>
    <input type="hidden" name="role[permissions][]" value="">
  </div>

  <%# Actions %>
  <div class="flex items-center gap-4 pt-4 border-t border-gray-100">
    <%= form.submit role.new_record? ? "Create Role" : "Save Changes",
      class: "bg-gray-900 text-white text-xs font-semibold tracking-widest uppercase px-6 py-2.5 hover:bg-gray-700 transition-colors cursor-pointer" %>
    <%= link_to "Cancel", admin_roles_path,
      class: "text-xs font-semibold text-gray-400 hover:text-gray-700 transition-colors" %>
  </div>

<% end %>
