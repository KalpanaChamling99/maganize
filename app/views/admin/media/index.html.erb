<% content_for :page_title, "Media Library" %>

<%# Stats bar %>
<div class="mb-6 flex items-center justify-between">
  <p class="text-xs text-gray-400 uppercase tracking-widest font-semibold">
    <%= @attachments.total_count %> <%= "image".pluralize(@attachments.total_count) %>
  </p>
</div>

<% if @attachments.any? %>
  <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 xl:grid-cols-6 gap-4">
    <% @attachments.each do |attachment| %>
      <% blob = attachment.blob %>
      <div class="group relative bg-white border border-gray-200 overflow-hidden">

        <%# Thumbnail %>
        <div class="aspect-square bg-gray-100 overflow-hidden">
          <%= image_tag rails_blob_path(blob, disposition: "inline"),
            class: "w-full h-full object-cover transition-transform duration-200 group-hover:scale-105",
            loading: "lazy",
            alt: blob.filename.to_s %>
        </div>

        <%# Info %>
        <div class="px-3 py-2 border-t border-gray-100">
          <p class="text-xs font-medium text-gray-700 truncate" title="<%= blob.filename %>">
            <%= blob.filename %>
          </p>
          <p class="text-xs text-gray-400 mt-0.5">
            <%= number_to_human_size(blob.byte_size) %>
          </p>
          <% article = attachment.record %>
          <% if article %>
            <%= link_to edit_admin_article_path(article),
              class: "text-xs text-blue-500 hover:text-blue-700 truncate block mt-0.5",
              title: article.title do %>
              <%= article.title&.truncate(28) %>
            <% end %>
          <% end %>
        </div>

        <%# Delete overlay %>
        <div class="absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity">
          <%= button_to admin_medium_path(attachment), method: :delete,
            data: { turbo_confirm: "Delete \"#{blob.filename}\"? This cannot be undone." },
            class: "flex items-center justify-center w-7 h-7 bg-red-600 text-white hover:bg-red-700 transition-colors shadow",
            title: "Delete image" do %>
            <svg class="w-3.5 h-3.5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
            </svg>
          <% end %>
        </div>

      </div>
    <% end %>
  </div>

  <%= render "shared/pagination", collection: @attachments, label: "images", per_page_options: [12, 24, 48] %>

<% else %>
  <div class="bg-white border border-gray-200 px-6 py-20 text-center">
    <svg class="w-10 h-10 text-gray-300 mx-auto mb-3" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
      <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 15.75l5.159-5.159a2.25 2.25 0 013.182 0l5.159 5.159m-1.5-1.5l1.409-1.409a2.25 2.25 0 013.182 0l2.909 2.909M3.75 21h16.5M4.5 3h15A1.5 1.5 0 0121 4.5v15A1.5 1.5 0 0119.5 21h-15A1.5 1.5 0 013 19.5v-15A1.5 1.5 0 014.5 3z"/>
    </svg>
    <p class="text-gray-400 text-sm">No images uploaded yet.</p>
    <%= link_to "Upload images via an article â†’", new_admin_article_path,
      class: "text-sm font-semibold text-gray-900 underline mt-2 inline-block" %>
  </div>
<% end %>
