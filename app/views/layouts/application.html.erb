<!DOCTYPE html>
<html lang="en">
  <head>
    <title>The Magazine</title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <link rel="icon" type="image/svg+xml" href="/favicon.svg">
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">

    <%= stylesheet_link_tag "tailwind", "data-turbo-track": "reload" %>
    <%= stylesheet_link_tag "application", "data-turbo-track": "reload" %>
    <%= javascript_importmap_tags %>
    <%= yield :head %>
  </head>

  <body class="bg-white text-gray-900 font-sans antialiased"
        data-controller="scroll-progress theme">

    <%# ── Top bar: date | social + toggle + subscribe ─────── %>
    <div class="site-banner border-b border-gray-200 bg-white">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 flex items-center justify-between h-9">
        <%# Date — left %>
        <span class="site-banner-date text-xs tracking-widest text-gray-500 uppercase hidden sm:block">
          <%= Date.today.strftime("%A, %B %-d, %Y") %>
        </span>
        <%# Social icons + subscribe — right %>
        <div class="flex items-center gap-3 ml-auto">
          <%# Social icons %>
          <div class="hidden sm:flex items-center gap-2">
            <%# Facebook %>
            <a href="#" aria-label="Facebook" class="site-social-icon text-gray-400 hover:text-gray-700 transition-colors">
              <svg class="w-3.5 h-3.5" fill="currentColor" viewBox="0 0 24 24"><path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"/></svg>
            </a>
            <%# Twitter/X %>
            <a href="#" aria-label="Twitter" class="site-social-icon text-gray-400 hover:text-gray-700 transition-colors">
              <svg class="w-3.5 h-3.5" fill="currentColor" viewBox="0 0 24 24"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>
            </a>
            <%# Instagram %>
            <a href="#" aria-label="Instagram" class="site-social-icon text-gray-400 hover:text-gray-700 transition-colors">
              <svg class="w-3.5 h-3.5" fill="currentColor" viewBox="0 0 24 24"><rect x="2" y="2" width="20" height="20" rx="5" ry="5"/><path fill="white" d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"/><line x1="17.5" y1="6.5" x2="17.51" y2="6.5" stroke="white" stroke-width="2" stroke-linecap="round"/></svg>
            </a>
            <%# YouTube %>
            <a href="#" aria-label="YouTube" class="site-social-icon text-gray-400 hover:text-gray-700 transition-colors">
              <svg class="w-3.5 h-3.5" fill="currentColor" viewBox="0 0 24 24"><path d="M22.54 6.42a2.78 2.78 0 0 0-1.95-1.96C18.88 4 12 4 12 4s-6.88 0-8.59.46A2.78 2.78 0 0 0 1.46 6.42 29 29 0 0 0 1 12a29 29 0 0 0 .46 5.58A2.78 2.78 0 0 0 3.41 19.6C5.12 20 12 20 12 20s6.88 0 8.59-.46a2.78 2.78 0 0 0 1.95-1.95A29 29 0 0 0 23 12a29 29 0 0 0-.46-5.58z"/><polygon fill="white" points="9.75 15.02 15.5 12 9.75 8.98 9.75 15.02"/></svg>
            </a>
          </div>
          <%# Thin divider %>
          <span class="hidden sm:block w-px h-4 bg-gray-200"></span>
          <%# Subscribe %>
          <%= link_to "Subscribe", "#",
            class: "subscribe-btn bg-gray-900 text-white text-xs font-semibold tracking-widest uppercase px-4 py-1.5 hover:bg-gray-700 transition-colors" %>
        </div>
      </div>
    </div>

    <%# ── Masthead: large centered title ─────────────────── %>
    <header class="site-header border-b border-gray-200">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 py-8 sm:py-10 text-center">
        <div class="flex items-center gap-4 mb-5">
          <span class="flex-1 h-px bg-gray-200 masthead-rule"></span>
          <span class="site-est text-[10px] tracking-[0.3em] text-gray-400 uppercase">Est. 2024</span>
          <span class="flex-1 h-px bg-gray-200 masthead-rule"></span>
        </div>
        <%= link_to root_path do %>
          <h1 class="site-title font-serif text-5xl sm:text-7xl font-bold tracking-tight text-gray-900 leading-none">
            The Magazine
          </h1>
          <p class="site-tagline text-xs tracking-[0.35em] text-gray-400 uppercase mt-3">Stories that matter</p>
        <% end %>
        <span class="block h-px bg-gray-200 masthead-rule mt-5"></span>
      </div>
    </header>

    <%# Sentinel — sits just above the nav; when it leaves the viewport the nav turns dark %>
    <div data-scroll-progress-target="sentinel" aria-hidden="true"></div>

    <%# Nav — dark background, becomes fixed once sentinel leaves viewport %>
    <nav class="site-nav bg-gray-900 overflow-x-auto" data-scroll-progress-target="nav">
      <div class="max-w-7xl mx-auto px-4 sm:px-6">
        <ul class="flex items-center gap-0 text-sm font-medium whitespace-nowrap w-full">
          <li>
            <%= link_to root_path,
              class: "site-nav-home flex items-center justify-center px-4 py-3 bg-red-500 text-white hover:bg-red-600 transition-colors border-b-2 border-red-500",
              aria: { label: "Home" },
              title: "Home" do %>
              <svg class="w-4 h-4 shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                <polyline points="9 22 9 12 15 12 15 22"/>
              </svg>
            <% end %>
          </li>
          <% Category.joins(:articles).merge(Article.published).distinct.limit(5).each do |cat| %>
            <li>
              <%= link_to cat.name, category_path(cat),
                class: "site-nav-link block px-4 py-3 text-gray-300 hover:text-white transition-colors" %>
            </li>
          <% end %>
          <li>
            <%= link_to "All Articles", articles_path,
              class: "site-nav-link block px-4 py-3 text-gray-300 hover:text-white transition-colors" %>
          </li>
          <li>
            <%= link_to "Tags", tags_path,
              class: "site-nav-link block px-4 py-3 text-gray-300 hover:text-white transition-colors" %>
          </li>
          <li>
            <%= link_to "About", about_path,
              class: "site-nav-link block px-4 py-3 text-gray-300 hover:text-white transition-colors" %>
          </li>
          <li>
            <%= link_to "Contact", contact_path,
              class: "site-nav-link block px-4 py-3 text-gray-300 hover:text-white transition-colors" %>
          </li>
          <li>
            <%= link_to "Collections", collections_path,
              class: "site-nav-link block px-4 py-3 text-gray-300 hover:text-white transition-colors" %>
          </li>
          <%# Theme toggle — end of nav %>
          <li class="ml-auto flex items-center px-4">
            <button class="theme-float"
                    data-action="click->theme#toggle"
                    aria-label="Toggle theme"
                    title="Toggle dark/light mode">
              <span class="theme-float-track">
                <svg class="theme-float-sun-icon" width="12" height="12" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                  <circle cx="12" cy="12" r="5"/>
                  <path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/>
                </svg>
                <span class="theme-float-knob"></span>
                <svg class="theme-float-moon-icon" width="12" height="12" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
                </svg>
              </span>
            </button>
          </li>
        </ul>
      </div>
    </nav>

    <%# Spacer — takes the nav's height when nav becomes fixed, preventing content jump %>
    <div data-scroll-progress-target="spacer" style="height:0;" aria-hidden="true"></div>

    <%# Progress bar — fixed just below the nav when nav is fixed %>
    <div data-scroll-progress-target="bar"
         style="display:none;position:fixed;top:0;left:0;width:100%;height:3px;background:#ef4444;transform:scaleX(0);transform-origin:left;transition:transform 80ms linear;pointer-events:none;z-index:41;"
         aria-hidden="true"></div>

    <%# Main content %>
    <main class="max-w-7xl mx-auto px-4 sm:px-6 py-10">
      <%= yield %>
    </main>

    <%# Footer %>
    <footer class="bg-gray-900 text-gray-300 mt-16">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 py-12">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-10 border-b border-gray-700 pb-10">
          <div>
            <h2 class="font-serif text-2xl font-bold text-white mb-3">The Magazine</h2>
            <p class="text-sm leading-relaxed text-gray-400">
              Stories that matter, perspectives that inspire, ideas that endure.
            </p>
          </div>
          <div>
            <h4 class="text-xs font-semibold tracking-widest uppercase text-gray-500 mb-4">Sections</h4>
            <ul class="space-y-2 text-sm">
              <% Category.joins(:articles).merge(Article.published).distinct.each do |cat| %>
                <li><%= link_to cat.name, category_path(cat), class: "hover:text-white transition-colors" %></li>
              <% end %>
              <li><%= link_to "All Articles", articles_path, class: "hover:text-white transition-colors" %></li>
            </ul>
          </div>
          <div>
            <h4 class="text-xs font-semibold tracking-widest uppercase text-gray-500 mb-4">About</h4>
            <ul class="space-y-2 text-sm">
              <li><%= link_to "About Us", about_path, class: "hover:text-white transition-colors" %></li>
              <li><%= link_to "Contact", contact_path, class: "hover:text-white transition-colors" %></li>
              <li><a href="#" class="hover:text-white transition-colors">Advertise</a></li>
              <li><a href="#" class="hover:text-white transition-colors">Privacy Policy</a></li>
            </ul>
          </div>
        </div>
        <p class="text-xs text-gray-600 mt-6 text-center">
          &copy; <%= Date.today.year %> The Magazine. All rights reserved.
        </p>
      </div>
    </footer>

    <%# ── Back-to-top ──────────────────────────────────────── %>
    <button data-scroll-progress-target="btn"
            data-action="click->scroll-progress#scrollToTop"
            title="Back to top"
            style="display:none;"
            class="scroll-top-btn focus:outline-none">
      <svg width="44" height="44" viewBox="0 0 44 44" style="display:block;transform:rotate(-90deg);">
        <circle cx="22" cy="22" r="19" fill="#ffffff" stroke="#fecaca" stroke-width="2"/>
        <circle data-scroll-progress-target="arc"
                cx="22" cy="22" r="19"
                fill="none" stroke="#ef4444" stroke-width="3"
                stroke-linecap="round"
                stroke-dasharray="119.38"
                stroke-dashoffset="119.38"
                style="transition:stroke-dashoffset 80ms linear;"/>
      </svg>
      <span style="position:absolute;inset:0;display:flex;align-items:center;justify-content:center;">
        <span data-scroll-progress-target="pct"
              class="scroll-pct"
              style="font-size:10px;font-weight:700;line-height:1;color:#ef4444;font-family:inherit;letter-spacing:0;">0%</span>
        <span class="scroll-arr" style="display:none;align-items:center;justify-content:center;color:#ef4444;">
          <svg width="14" height="14" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
            <path stroke-linecap="round" stroke-linejoin="round" d="M5 15l7-7 7 7"/>
          </svg>
        </span>
      </span>
    </button>

  </body>
</html>
