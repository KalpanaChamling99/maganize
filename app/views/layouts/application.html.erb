<!DOCTYPE html>
<html lang="en">
  <head>
    <title>The Magazine</title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <link rel="icon" type="image/svg+xml" href="/favicon.svg">
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">

    <%= stylesheet_link_tag "tailwind", "data-turbo-track": "reload" %>
    <%= stylesheet_link_tag "application", "data-turbo-track": "reload" %>
    <%= javascript_importmap_tags %>
    <%= yield :head %>
  </head>

  <body class="bg-white text-gray-900 font-sans antialiased"
        data-controller="scroll-progress">

    <%# Top banner %>
    <div class="border-b border-gray-200 bg-gray-50 py-1.5 text-center text-xs tracking-widest text-gray-500 uppercase">
      <%= Date.today.strftime("%A, %B %-d, %Y") %>
    </div>

    <%# Masthead %>
    <header class="border-b border-gray-200">
      <div class="max-w-7xl mx-auto px-4 sm:px-6">
        <div class="flex items-center justify-between py-5">
          <div class="text-xs tracking-widest text-gray-500 uppercase hidden sm:block">
            Est. 2024
          </div>
          <%= link_to root_path, class: "text-center" do %>
            <h1 class="font-serif text-4xl sm:text-5xl font-bold tracking-tight text-gray-900 leading-none">
              The Magazine
            </h1>
            <p class="text-xs tracking-[0.3em] text-gray-400 uppercase mt-1">Stories that matter</p>
          <% end %>
          <div class="hidden sm:block">
            <%= link_to "Subscribe", "#",
              class: "bg-gray-900 text-white text-xs font-semibold tracking-widest uppercase px-5 py-2.5 hover:bg-gray-700 transition-colors" %>
          </div>
        </div>
      </div>
    </header>

    <%# Sentinel — sits just above the nav; when it leaves the viewport the nav turns dark %>
    <div data-scroll-progress-target="sentinel" aria-hidden="true"></div>

    <%# Nav — becomes fixed (dark) once sentinel leaves viewport %>
    <nav class="site-nav overflow-x-auto" data-scroll-progress-target="nav">
      <div class="max-w-7xl mx-auto px-4 sm:px-6">
        <ul class="flex items-center gap-0 text-sm font-medium whitespace-nowrap w-full">
          <li>
            <%= link_to "Home", root_path,
              class: "block px-4 py-3 border-b-2 border-gray-900 transition-colors" %>
          </li>
          <% Category.joins(:articles).merge(Article.published).distinct.limit(5).each do |cat| %>
            <li>
              <%= link_to cat.name, category_path(cat),
                class: "block px-4 py-3 border-b-2 border-transparent hover:border-gray-300 transition-colors" %>
            </li>
          <% end %>
          <li>
            <%= link_to "All Articles", articles_path,
              class: "block px-4 py-3 border-b-2 border-transparent hover:border-gray-300 transition-colors" %>
          </li>
          <li>
            <%= link_to "Tags", tags_path,
              class: "block px-4 py-3 border-b-2 border-transparent hover:border-gray-300 transition-colors" %>
          </li>
          <li>
            <%= link_to "About", about_path,
              class: "block px-4 py-3 border-b-2 border-transparent hover:border-gray-300 transition-colors" %>
          </li>
          <li>
            <%= link_to "Contact", contact_path,
              class: "block px-4 py-3 border-b-2 border-transparent hover:border-gray-300 transition-colors" %>
          </li>
          <li>
            <%= link_to "Collections", collections_path,
              class: "block px-4 py-3 border-b-2 border-transparent hover:border-gray-300 transition-colors" %>
          </li>
        </ul>
      </div>
    </nav>

    <%# Spacer — takes the nav's height when nav becomes fixed, preventing content jump %>
    <div data-scroll-progress-target="spacer" style="height:0;" aria-hidden="true"></div>

    <%# Progress bar — fixed just below the nav when nav is fixed %>
    <div data-scroll-progress-target="bar"
         style="display:none;position:fixed;top:0;left:0;width:100%;height:3px;background:#ef4444;transform:scaleX(0);transform-origin:left;transition:transform 80ms linear;pointer-events:none;z-index:41;"
         aria-hidden="true"></div>

    <%# Main content %>
    <main class="max-w-7xl mx-auto px-4 sm:px-6 py-10">
      <%= yield %>
    </main>

    <%# Footer %>
    <footer class="bg-gray-900 text-gray-300 mt-16">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 py-12">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-10 border-b border-gray-700 pb-10">
          <div>
            <h2 class="font-serif text-2xl font-bold text-white mb-3">The Magazine</h2>
            <p class="text-sm leading-relaxed text-gray-400">
              Stories that matter, perspectives that inspire, ideas that endure.
            </p>
          </div>
          <div>
            <h4 class="text-xs font-semibold tracking-widest uppercase text-gray-500 mb-4">Sections</h4>
            <ul class="space-y-2 text-sm">
              <% Category.joins(:articles).merge(Article.published).distinct.each do |cat| %>
                <li><%= link_to cat.name, category_path(cat), class: "hover:text-white transition-colors" %></li>
              <% end %>
              <li><%= link_to "All Articles", articles_path, class: "hover:text-white transition-colors" %></li>
            </ul>
          </div>
          <div>
            <h4 class="text-xs font-semibold tracking-widest uppercase text-gray-500 mb-4">About</h4>
            <ul class="space-y-2 text-sm">
              <li><%= link_to "About Us", about_path, class: "hover:text-white transition-colors" %></li>
              <li><%= link_to "Contact", contact_path, class: "hover:text-white transition-colors" %></li>
              <li><a href="#" class="hover:text-white transition-colors">Advertise</a></li>
              <li><a href="#" class="hover:text-white transition-colors">Privacy Policy</a></li>
            </ul>
          </div>
        </div>
        <p class="text-xs text-gray-600 mt-6 text-center">
          &copy; <%= Date.today.year %> The Magazine. All rights reserved.
        </p>
      </div>
    </footer>

    <%# ── Back-to-top ──────────────────────────────────────── %>
    <button data-scroll-progress-target="btn"
            data-action="click->scroll-progress#scrollToTop"
            title="Back to top"
            style="display:none;"
            class="scroll-top-btn focus:outline-none">
      <svg width="44" height="44" viewBox="0 0 44 44" style="display:block;transform:rotate(-90deg);">
        <circle cx="22" cy="22" r="19" fill="#ffffff" stroke="#fecaca" stroke-width="2"/>
        <circle data-scroll-progress-target="arc"
                cx="22" cy="22" r="19"
                fill="none" stroke="#ef4444" stroke-width="3"
                stroke-linecap="round"
                stroke-dasharray="119.38"
                stroke-dashoffset="119.38"
                style="transition:stroke-dashoffset 80ms linear;"/>
      </svg>
      <span style="position:absolute;inset:0;display:flex;align-items:center;justify-content:center;">
        <span data-scroll-progress-target="pct"
              class="scroll-pct"
              style="font-size:10px;font-weight:700;line-height:1;color:#ef4444;font-family:inherit;letter-spacing:0;">0%</span>
        <span class="scroll-arr" style="display:none;align-items:center;justify-content:center;color:#ef4444;">
          <svg width="14" height="14" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
            <path stroke-linecap="round" stroke-linejoin="round" d="M5 15l7-7 7 7"/>
          </svg>
        </span>
      </span>
    </button>

  </body>
</html>
